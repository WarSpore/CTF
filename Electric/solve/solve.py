from math import gcd
from Crypto.Util.number import long_to_bytes, isPrime


def extended_gcd(a, b):
    old_r, r = a, b
    old_s, s = 1, 0
    old_t, t = 0, 1

    while r != 0:
        quotient = old_r // r
        old_r, r = r, old_r - quotient * r
        old_s, s = s, old_s - quotient * s
        old_t, t = t, old_t - quotient * t
    return old_s, old_t, old_r

ct = 15599817312087838833704632279017883161676791085039076444563344169840588125530697400157693034360569709416107524770755249964861589916880436051680182429446428014438647266989433202187401897941897884487020946682897641610841456469041128845171234419390256525367349460153576691075708799227626902997034390861490188609261312390099557901171774110626278653620676621761370230789834054639838189899662332658567617105797653883734666167487971079160673567671755660683895123966063609197321916891111528534505958431596841205819301455426891019902956020258695795717955694185664057431777896764164619069338729983324578909938814706555427993319
e = 65537
a,b = (-15031320841187090205796125674696580906358618345270457325350277971483199628722232374974653720650852722122083001446931346096957820111721436460470382584719144314669385718634267413303766147037844448829668250145567253908858196379611295193721263377435120489141356119720208099989000277736130324935940276821727190650, 21163038100504353557309818489479333035358731777847137577705531181160508032628726767683360746849641705779308539820874250835067943437038491479295081432101722933254893539909517286020941487294650069148219843915803833997393774938221902776933735566267165634712871741732788347665985115990416317619721742938262344837)
if gcd(a, b) != 1:
    print("Error: a and b are not coprime, the equation will not have integer solutions.")
    exit()

p, q, gcd_ab = extended_gcd(a, b)
print(f"p = {p}")
print(f"q = {q}")

check = a * p + b * q
print(f"\nVerification: a * p + b * q = {check}")

e = 65537

p = 148361670675546820212749768441603205212453980893591783603718353628026497633910446009804697203018110835134385708135023186872260569215115273674251997712549564392665956119568948031470819125190530154851090212118220300908462475153674282131177654054214957496168556067202553964112002014192077401203704303803205606783  
q = 105375790652927843491620035779430889562159097367026886368035487696153434787708559276239777410595113245385852641196101831074388179079122103632512991652053431898205679910374578499668340647427154785468498444605266543498563067361885043857444868273071414888213148451906275454914783858786726355904146204311407572123  



print(isPrime(p),isPrime(q))

phi = (p-1)*(q-1)

d = pow(e,-1,phi)

n = p*q 

print(long_to_bytes(pow(ct,d,n)))