import requests
import re
import time

# List of N values to factorize (Replace with your actual values)
n_values = [645423052299450903780428554773396338982466250732776133712070761322544515926451862893993554859220407973974709851951251835305162892446425515479550261231400, 3191862893053482460859697667669954719884373486408143693487757448350816584800659911525715890802697745600524199555232116882138037242593665171317399146187198, 56226921144264282939455704505762365167935793415906286913347368679332110911752471131295458864799106477356668817582460977479686613018349128894413465649864, 8209603813335076641626570411347610308494940492598316793158589667011746872383574908903790124085239093500321695618170059418012018029925772765434214436425116, 5539259801780880091303739905045444531775101837638900026336027802886728826194514824608939605207704258134856129191086095793743801914750426770238581157158650, 4948597851418791453808025992553344564754934559639655725261855931715770411135410736359872695375172885707329094041799386743738778972408179686764708718583654, 934982571194045909539531009566810559916259772042246357884711685028894268189754739424641588284439336310199575432718643919671887094841187851863599224369114, 4597330223111344034907307180732817319067845734384858965766649321170981395928980069501846000532304015440658780936100505775929497896652151373307948282754486, 369661107565753276748161162926100981883967518816342368641848272549392402613054586639781564908400265611294029323612410246122385287123523235601708665220500, 1055535759092646084562291858074387737620865938858744631214004213402595276235893549276184392988115743034330668304765942352199553332668430748455429296393136, 1606476047468220464411186832569640387988645678931707899730198293500473836716796917319313783241517923161833849841632006602031876111895566054640294722287448, 962742246041584700554696254358961449696618198231964852458547718987672196078262772873496519575807066000422584691340342521673085326914470746639690756917816, 204272817895079151848187787945799588178900546034141865426031696549501025590752151323522712666849330885828607380567770206435179140435085331857668650878135, 4440286383384575354794263508729751797214595398292971049649904981011432380915954959838962042637467781520094552210466971570840585971646370128681785483779584, 1669087380653247435090245465643582738167893848816926702426380666567780470114366613625682945286487251421742540770094541855561327550257643355263504858173860, 1800235481240762790433284181008603351242859211337482801998316470160143993068362703073420488454146330840125966116560142877273957745872507895209972259908844, 2128933426288475100727805296812956826209077776902176740867706084927477536700163138309135420584284953349894638257755184151581407704786651403564813137319228, 419108656004780327301944269618457623160894060457584335061745115868580168268718159381501233681143041238781398360414507477451006610853860542684388344599066, 5434709287211525452740767407367379908478635095972691339354130861225390814339912332967889265619706941913273065650950358321334745810771877022977095282848277, 786311171013846448863405559873867625047607531995726199870071884707148333312254113487394249517454102860958944891707993157529441187099974550604404435416820, 6230019856566805046275717176041237303424689828449760924867956709972017160088939141068116894772337185741445793601439205305277532265217106661137299270350393, 4328556462256686400125896711606970070611204008215423422150867873193379499713809293752999805017894486197766870774234785547078346104957769904475661268560834, 4876023455233931592878212119064193105618547405469637939274466308841549001640229300881841363951154327407945629550569154602663035131214720256031065790362955, 1850766273389177673701765825300684090013786402001606069107949987640192903569116661899757104686831857785093061299756035593220580450222217879342964276990866, 5185332752463286202186222168222096785489002148986667455759477473779494452360721839078677372183729011106502613996890791292270012144753084059307367785590879, 9434576828888992207533885387376016970662438535047351904998943095014143335669799026505331985619214217296662815858985155650890142409288628946236709697880, 4340208748709925674027283655334588589388942584298754468240333389258341474228952833895080263272371587979552227307943232055917062659123231582564741584756160, 1057474647044481879542192639969891847021460268859778962529131788866336741416243510367468866564699033623752643606305346606396050877193674611030778333880104, 5135408862449273948200128117910308984165274989648144461056376723206636240255068915764641513577375820064904563124345536468291360255348630539471464760519460, 755248190460643029601634644280130227817982917170660346114645597252522636903042591264461532089527889292009305969586258688717674086581482547178266320816000, 5732006683366284161833072230981112342628254135828020794263374296406417661881656623609089958536981629418258385096483828909985510310804224980418257655790620, 183311896717349732334390817369691260998645995960749963708963864404175088781522066369169610867708968948840191478595539386407586212774387931369979805839330, 87008279885830558539907475054065451005439765727368052667120835992976940216766854343565102988349706986652268641792546775215958188370317123619445508887230, 4228088569214623560784336869407890665681785816562639163819637355368096007673040778066299842225752409597290618197922429060738712780969945299988317672843318, 1244764770047230205826199150924884820807303777720159994737544477389120974787045784798994965445925977520229811372811615592904242792135141050564847300045360, 1067203249023926445874674925233650595438405765149851345905674566107746587121410837771879513699029718024105705000362796320408362012363472971980710638481840, 7046921661010660764458745016236218675231884952792895902952665073798131369273043481410322741180964826868195897806524110132912491479107437739949289646937680, 2007676173060227617342774066984788137274031637792999317667024674126838400254901783930292282116650913926633343101038435745986843096632083533675572603946976, 3260492415888839595893455027088265656735338438719871715770775440142846833217899694565657236729594951909134599081500394965036122515613970127014511029120942, 1058685900269221016421740318224407829715654128447211369254021734093714410482654926153663245698603071762568785057187510084511379360794179053615234191347782, 543765893724590159990621863795521234184395610403442322995563913696277637377834098418661444826020577193408465594588302308694206993885600123080557832391930, 5680854898998394190863025898505168125429657455166207973187201325035374405946105289119602182186867278284700834289802909593392079174791786086458524918483964, 12015143721810508298840001410360998854383944140309753010261507124612483272543938374718835517007737577687749510175702932918117187823915944385698449472508416, 1581329690638663434830570551691166041442623347193127468297596368851025112093777392342077011162013739763820482795072783172683608075164392965732064516167776, 3765902570741237102620668728547574212411740182813597225915294312524146496036889388468209028238115537820343005910606016965072406207808684585838464977727945, 320625361463824217622607498723330238615729598398737185442217602334491770464206332293777864906210842850166079495554965078131779102115631830231557538377095, 11675902188996456031521838191944403581868709442141521910461057987761544220339389696921068041066629308493799729865162602374239330381118035187536580191515872, 1882153124068740854600202096163334659182912163073660689752782880274440387894158467649701027141790869840206617854910061722315328535631986200975138490482742, 7809151133735660796224912417745901355680510788694385252931717068697578311614050531558616103006974133575742429881260261341444876235003772995596934515303464, 6507554191369610105298072165441023324808373471258120583391213723037142103730852956744712844428012344936620012818063811463957908333871783010763373749654749, 215559419036250335727639486875054433138395910315871081838406273659626019314048186842808110261930342374842826776532572579235222542670363424703007957850656, 271595375390465214011966115445294497690698381712251726692026222217603711858543198038712381282239562852871586507938083925398908252771491770496787484240982, 1963705356996187518071906750512601720966602563473624435724584298499975375048498643032574569954829117722239500242857029889669587005623369833291197229022768, 3149837584342774845157228328376761683874466244679441930962908082870882695844585208073986606893907296380900033216387003082954731238333272883311415340364448, 25603355453194346823446024860816877459103611786540264608296883579086551731778500452883628944873522807464953816221352072063224602954750587108489399455623, 2155049972526496613568003747685521313821014660612136453586831721569116051664059018831083633895898410594322578892354288967704406510874492866882923666283424, 1665619766059711455461128343780763859543010330601084975573237329161518043096209883474983685413613913742336554267486073243263272540910646857316150877921332, 1853248471609886944363419393239687686427359832429833889919382679182429970508041307013043031438444852093376271670440191686840531491788165458190267986378955, 212435049819767127756554632360726864554354545631698575672366655416905477747138565861867600253399876647327473067908932879252041839321269410962589145311080, 1960978655685103220776717787893557171014212289947196092646350459780376862730049193188878944209122563247505729978054989356505803514423341970803617840686506, 194221979700034235740825747833939501366007511148364701356309922453862557261875697859412533373219082991490969774866147562335488668268521389749702118842723, 5393092270440769258212093467489492793924436254809553224428403392041356184833358938586087036217679655957996834288208781612526318317728130804347024701289009, 331695845949512618875672274012724437431989651251848417729594927857764842033940978568500271264703830738113274525817148500383448522916509777948379906133759, 6075631821385866709667116118858064249869696572868764055454939445976950560338089793601488239811197756609512545489685139125898164149410170212296376722472310]
print(len(n_values))
def fetch_full_number(factor_id):
    """Fetch the full number for a given FactorDB ID if truncated."""
    url = f"http://factordb.com/index.php?id={factor_id}"
    response = requests.get(url)
    if response.status_code != 200:
        print(f"Failed to fetch full number for ID = {factor_id}")
        return None

    # Extract the full number from the input field
    match = re.search(r'name="query" value="([\d]+)"', response.text)
    if match:
        return int(match.group(1))
    return None

def fetch_factors(n):
    """Queries FactorDB for N and extracts its prime factors with exponents."""
    url = f"http://factordb.com/index.php?query={n}"
    response = requests.get(url)
    if response.status_code != 200:
        print(f"Failed to fetch data for N = {n}")
        return None

    # Adjusted regex: capture the factorization from the <td> element containing "=".
    fac_section_match = re.search(
        r'<tr>\s*<td[^>]*>\s*FF\s*</td>\s*<td[^>]*>.*?</td>\s*<td[^>]*>(.*?)</td>',
        response.text,
        re.DOTALL
    )
    if not fac_section_match:
        print(f"Could not extract factor data for N = {n}")
        return None
    fac_section = fac_section_match.group(1)
    
    # Debug: uncomment to print the captured factorization section

    # Extract each factor link with its exponent or subscript using regex.
    factor_matches = re.findall(
        r'<a href="index\.php\?id=(\d+)">.*?<font color="[^"]+">([\d\.]+)(?:\^(\d+))?</font></a>(?:<sub>&lt;(\d+)&gt;</sub>)?',
        fac_section
    )
    
    if not factor_matches:
        print(f"Could not extract factor data for N = {n}")
        return None

    factors = []
    for fid, num_str, exp_str, sub in factor_matches:
        # If the displayed number is truncated (contains '...'), try to fetch the full value.
        if "..." in num_str:
            full_number = fetch_full_number(fid)
            if full_number:
                number = full_number
            else:
                print(f"Warning: Could not fetch full number for ID {fid}")
                continue
        else:
            number = int(num_str)
            
        exponent = int(exp_str) if exp_str else 1
        factors.append((number, exponent))
    
    return factors if factors else None

# Process each N value
factored_results = {}
for n in n_values:
    print(f"Querying FactorDB for N = {n} ...")
    factors = fetch_factors(n)
    if factors:
        # Sometimes FactorDB first shows the composite number itself. Remove it if present.
        if factors and factors[0][0] == n:
            factors = factors[1:]
        factored_results[n] = factors
        print(f"Factors found: {factors}")
    else:
        print(f"Failed to factorize N = {n}")
    time.sleep(2)  # Respect FactorDB rate limits

# Output final results to a file
output_file = r'Cyberlandslagkval2025\\Crypto\\Cryptography_rsa2_handout_new\\factors2.txt'
with open(output_file, 'w') as fil:
    i = 0
    for n, factors in factored_results.items():
        i+=1
        print(factors)
        fil.write(f"N = {n} \nFactors = {factors} \n")
    print(i)
